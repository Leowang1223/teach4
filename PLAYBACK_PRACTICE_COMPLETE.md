# å›žæ”¾ç·´ç¿’åŠŸèƒ½å¯¦ä½œå®Œæˆ âœ…

## ðŸ“‹ åŠŸèƒ½æ¦‚è¿°

æˆåŠŸåœ¨å­¸ç¿’è¨˜éŒ„é é¢æ–°å¢žã€Œå›žæ”¾ç·´ç¿’ã€åŠŸèƒ½ï¼Œè®“ä½¿ç”¨è€…å¯ä»¥ï¼š
- æŸ¥çœ‹æ‰€æœ‰å·²å®Œæˆçš„èª²ç¨‹å’Œé¡Œç›®
- é‡æ–°ç·´ç¿’ä»»ä½•å·²å®Œæˆçš„é¡Œç›®
- è¿½è¹¤æ¯å€‹é¡Œç›®çš„æœ€é«˜åˆ†æ•¸å’Œç·´ç¿’æ¬¡æ•¸
- è½å–è‡ªå·±çš„éŒ„éŸ³
- ç²å¾—è©³ç´°çš„äº”ç¶­åº¦è©•åˆ†å’Œå»ºè­°

---

## ðŸŽ¯ å·²å¯¦ä½œåŠŸèƒ½

### 1. Tab åˆ‡æ›ä»‹é¢
- âœ… åœ¨å­¸ç¿’è¨˜éŒ„é é¢æ·»åŠ äº†å…©å€‹ Tabï¼š
  - ðŸ“Š **Learning Reports** (åŽŸæœ‰çš„å­¸ç¿’æ­·å²å ±è¡¨)
  - ðŸ”„ **Playback Practice** (æ–°å¢žçš„å›žæ”¾ç·´ç¿’)
- âœ… ä½¿ç”¨æ¼¸å±¤è‰²æŒ‰éˆ•ï¼Œèˆ‡ç¾æœ‰ UI é¢¨æ ¼ä¸€è‡´

### 2. å›žæ”¾ç·´ç¿’åˆ—è¡¨é é¢
**ä½ç½®:** `/history?tab=playback`

**åŠŸèƒ½:**
- âœ… é¡¯ç¤ºæ‰€æœ‰å·²å®Œæˆçš„èª²ç¨‹
- âœ… èª²ç¨‹å¡ç‰‡å¯å±•é–‹/æ”¶åˆ
- âœ… é¡¯ç¤ºèª²ç¨‹è³‡è¨Šï¼š
  - å¹³å‡åˆ†æ•¸
  - é¡Œç›®æ•¸é‡
  - ç¸½ç·´ç¿’æ¬¡æ•¸
- âœ… å±•é–‹å¾Œé¡¯ç¤ºèª²ç¨‹å…§æ‰€æœ‰é¡Œç›®ï¼š
  - é¡Œç›®æ–‡å­—å’Œè‹±æ–‡æç¤º
  - æœ€é«˜åˆ†æ•¸ (â­ æ¨™è¨˜)
  - ç·´ç¿’æ¬¡æ•¸
  - Practice æŒ‰éˆ•

### 3. å–®é¡Œç·´ç¿’é é¢
**ä½ç½®:** `/history/playback/[lessonId]/[stepId]`

**å·¦å´å€åŸŸ (70%):**
- âœ… èª²ç¨‹å’Œé¡Œç›®è³‡è¨Šå¡ç‰‡
- âœ… é¡Œç›®é¡¯ç¤ºï¼š
  - ä¸­æ–‡é¡Œç›®
  - æ‹¼éŸ³ (å¦‚æžœæœ‰)
  - è‹±æ–‡æç¤º
- âœ… TTS æ’­æ”¾æŒ‰éˆ• (ðŸ”Š Listen to Question)
- âœ… éŒ„éŸ³æŽ§åˆ¶ï¼š
  - ðŸŽ§ æ’­æ”¾æˆ‘çš„éŒ„éŸ³ (æ’­æ”¾ä¸Šæ¬¡éŒ„éŸ³)
  - ðŸŽ¤ é–‹å§‹éŒ„éŸ³
  - â¹ï¸ åœæ­¢éŒ„éŸ³ (å¸¶å‹•ç•«æ•ˆæžœ)
- âœ… è‡ªå‹•é€å‡ºè©•åˆ†
- âœ… Loading å‹•ç•«

**å³å´å€åŸŸ (30% - å›ºå®šåœ¨å³ä¸Šè§’):**
- âœ… æ­·å²è¨˜éŒ„å¡ç‰‡ï¼š
  - â­ æœ€é«˜åˆ†æ•¸ (å¤§å­—é¡¯ç¤º)
  - ç¸½ç·´ç¿’æ¬¡æ•¸
  - æœ€å¾Œç·´ç¿’æ™‚é–“
- âœ… æœ€æ–°è©•åˆ†çµæžœ (éŒ„éŸ³å¾Œé¡¯ç¤º)ï¼š
  - æœ¬æ¬¡åˆ†æ•¸
  - ðŸŽ‰ New High Score æç¤º
  - äº”ç¶­åº¦åˆ†æ•¸æ˜Žç´°
  - ðŸ’¡ å„ç¶­åº¦å»ºè­° (suggestions)
  - ðŸŽ¯ ç·´ç¿’æ–¹æ³• (overallPractice)

### 4. è³‡æ–™ç®¡ç†ç³»çµ±

**playbackStorage.ts** - å®Œæ•´çš„è³‡æ–™ç®¡ç†å·¥å…·ï¼š
- âœ… `getPlaybackData()` - è®€å–æ‰€æœ‰å›žæ”¾è³‡æ–™
- âœ… `savePlaybackData()` - å„²å­˜è³‡æ–™
- âœ… `initializePlaybackFromHistory()` - å¾žå­¸ç¿’æ­·å²åˆå§‹åŒ–
- âœ… `getPlaybackLesson()` - ç²å–å–®å€‹èª²ç¨‹
- âœ… `getPlaybackQuestion()` - ç²å–å–®å€‹é¡Œç›®
- âœ… `addPlaybackAttempt()` - æ·»åŠ æ–°çš„ç·´ç¿’è¨˜éŒ„
- âœ… è‡ªå‹•æ›´æ–°æœ€é«˜åˆ†æ•¸
- âœ… è‡ªå‹•è¨ˆç®—èª²ç¨‹å¹³å‡åˆ†

**è³‡æ–™å„²å­˜æ–¹å¼:**
- âœ… ä½¿ç”¨ localStorage
- âœ… éŒ„éŸ³æª”æ¡ˆè½‰æ›ç‚º Base64 å„²å­˜ (åªå­˜æœ€å¾Œä¸€æ¬¡)
- âœ… ä¿å­˜å®Œæ•´çš„è©•åˆ†çµæžœå’Œå»ºè­°

---

## ðŸ“ æª”æ¡ˆçµæ§‹

```
apps/web/app/(protected)/history/
â”œâ”€â”€ page.tsx                                    # ä¸»é é¢ (åŒ…å« Tab åˆ‡æ›)
â”œâ”€â”€ utils/
â”‚   â””â”€â”€ playbackStorage.ts                     # è³‡æ–™ç®¡ç†å·¥å…·
â”œâ”€â”€ components/
â”‚   â””â”€â”€ PlaybackPracticeList.tsx               # å›žæ”¾ç·´ç¿’åˆ—è¡¨å…ƒä»¶
â””â”€â”€ playback/
    â””â”€â”€ [lessonId]/
        â””â”€â”€ [stepId]/
            â””â”€â”€ page.tsx                        # å–®é¡Œç·´ç¿’é é¢
```

---

## ðŸŽ¨ UI/UX ç‰¹è‰²

### 1. ä¸€è‡´çš„è¨­è¨ˆé¢¨æ ¼
- âœ… ä½¿ç”¨èˆ‡åŽŸç³»çµ±ç›¸åŒçš„æ¼¸å±¤è‰²ç³»ï¼š`from-blue-50 to-purple-50`
- âœ… å¡ç‰‡è¨­è¨ˆï¼š`rounded-xl shadow-lg`
- âœ… æŒ‰éˆ•é¢¨æ ¼ï¼šæ¼¸å±¤è‰²ã€åœ“è§’ã€hover æ•ˆæžœ
- âœ… é…è‰²æ–¹æ¡ˆï¼š
  - è—è‰²-ç´«è‰²æ¼¸å±¤ (ä¸»é¡Œè‰²)
  - ç¶ è‰² (å„ªç§€åˆ†æ•¸ >=90)
  - è—è‰² (è‰¯å¥½åˆ†æ•¸ >=75)
  - æ©˜è‰² (éœ€æ”¹é€² <75)

### 2. äº’å‹•å‹•ç•«
- âœ… éŒ„éŸ³æŒ‰éˆ•å‹•ç•« (`animate-pulse`)
- âœ… Loading spinner (`animate-spin`)
- âœ… å¡ç‰‡ hover æ•ˆæžœ (`hover:scale-105`)
- âœ… å¹³æ»‘çš„éŽæ¸¡å‹•ç•« (`transition-all`)

### 3. éŸ¿æ‡‰å¼è¨­è¨ˆ
- âœ… ä½¿ç”¨ Grid ä½ˆå±€ (`grid-cols-3`)
- âœ… å·¦å´ 2/3ï¼Œå³å´ 1/3
- âœ… å³å´å¡ç‰‡å›ºå®šåœ¨é ‚éƒ¨ (`sticky top-8`)

---

## ðŸ”§ æŠ€è¡“å¯¦ä½œç´°ç¯€

### 1. éŒ„éŸ³åŠŸèƒ½
```typescript
- ä½¿ç”¨ MediaRecorder API
- æ ¼å¼: audio/webm
- è‡ªå‹•åœæ­¢ä¸¦é€å‡ºè©•åˆ†
- éŒ„éŸ³è½‰ Base64 å„²å­˜
```

### 2. TTS åŠŸèƒ½
```typescript
- ä½¿ç”¨ Web Speech API
- èªžè¨€: zh-TW (ç¹é«”ä¸­æ–‡)
- é€Ÿåº¦: 0.9x (ç¨æ…¢ä»¥ä¾¿å­¸ç¿’)
```

### 3. éŸ³è¨Šæ’­æ”¾
```typescript
- Base64 â†’ Blob â†’ ObjectURL
- æ’­æ”¾çµæŸè‡ªå‹•é‡‹æ”¾è³‡æº
- é˜²æ­¢é‡è¤‡æ’­æ”¾
```

### 4. è©•åˆ† API æ•´åˆ
```typescript
- Endpoint: http://localhost:8082/api/score
- Method: POST
- Content-Type: multipart/form-data
- å›žå‚³: å®Œæ•´çš„è©•åˆ†çµæžœå’Œå»ºè­°
```

---

## ðŸ“Š è³‡æ–™æµç¨‹

### åˆå§‹åŒ–æµç¨‹
```
1. é€²å…¥ History é é¢
   â†“
2. è¼‰å…¥ lessonHistory (å­¸ç¿’æ­·å²)
   â†“
3. æª¢æŸ¥ playbackPractice (å›žæ”¾è³‡æ–™)
   â†“
4. å¦‚æžœæ²’æœ‰ â†’ å¾ž lessonHistory åˆå§‹åŒ–
   â†“
5. é¡¯ç¤ºèª²ç¨‹åˆ—è¡¨
```

### ç·´ç¿’æµç¨‹
```
1. é¸æ“‡èª²ç¨‹ â†’ å±•é–‹é¡Œç›®åˆ—è¡¨
   â†“
2. é»žæ“Šé¡Œç›® â†’ é€²å…¥ç·´ç¿’é é¢
   â†“
3. æ’­æ”¾ TTS / æ’­æ”¾è‡ªå·±çš„éŒ„éŸ³
   â†“
4. é–‹å§‹éŒ„éŸ³ â†’ åœæ­¢éŒ„éŸ³
   â†“
5. è‡ªå‹•é€å‡ºè©•åˆ† (é¡¯ç¤º Loading)
   â†“
6. æ”¶åˆ°è©•åˆ†çµæžœ
   â†“
7. é¡¯ç¤ºåœ¨å³å´å¡ç‰‡
   â†“
8. æ›´æ–°æœ€é«˜åˆ†æ•¸ (å¦‚æžœè¶…éŽ)
   â†“
9. å„²å­˜åˆ° localStorage
```

---

## âœ¨ ç‰¹æ®ŠåŠŸèƒ½

### 1. æœ€é«˜åˆ†æ•¸è¿½è¹¤
- æ¯æ¬¡éŒ„éŸ³å¾Œè‡ªå‹•æ¯”è¼ƒ
- åªè¨˜éŒ„æœ€é«˜åˆ†
- ðŸŽ‰ é¡¯ç¤º "New High Score!" æç¤º

### 2. ç·´ç¿’æ¬¡æ•¸çµ±è¨ˆ
- æ¯æ¬¡éŒ„éŸ³å¾Œ +1
- é¡¯ç¤ºåœ¨åˆ—è¡¨å’Œè©³æƒ…é 
- å¯è¿½è¹¤å­¸ç¿’é »çŽ‡

### 3. æ­·å²éŒ„éŸ³å›žæ”¾
- å„²å­˜æœ€å¾Œä¸€æ¬¡éŒ„éŸ³ (Base64)
- å¯éš¨æ™‚æ’­æ”¾
- è‡ªæˆ‘æª¢è¦–å’Œæ¯”è¼ƒ

### 4. è©³ç´°å»ºè­°ç³»çµ±
- äº”ç¶­åº¦ç¨ç«‹å»ºè­° (pronunciation, fluency, accuracy, comprehension, confidence)
- æ•´é«”ç·´ç¿’æ–¹æ³• (overallPractice)
- æ‰€æœ‰å»ºè­°çš†ç‚ºè‹±æ–‡

---

## ðŸš€ æ¸¬è©¦å»ºè­°

### 1. åŠŸèƒ½æ¸¬è©¦
```
âœ… Tab åˆ‡æ›æ­£å¸¸
âœ… èª²ç¨‹åˆ—è¡¨å±•é–‹/æ”¶åˆ
âœ… é»žæ“Šé¡Œç›®é€²å…¥ç·´ç¿’é é¢
âœ… TTS æ’­æ”¾
âœ… éŒ„éŸ³åŠŸèƒ½
âœ… æ’­æ”¾éŒ„éŸ³
âœ… è©•åˆ† API å‘¼å«
âœ… åˆ†æ•¸é¡¯ç¤ºå’Œæ›´æ–°
âœ… æœ€é«˜åˆ†æ›´æ–°
âœ… localStorage å„²å­˜
```

### 2. UI/UX æ¸¬è©¦
```
âœ… éŸ¿æ‡‰å¼ä½ˆå±€
âœ… å‹•ç•«æ•ˆæžœ
âœ… Loading ç‹€æ…‹
âœ… éŒ¯èª¤è™•ç†
âœ… è¿”å›žå°Žèˆª
```

### 3. è³‡æ–™å®Œæ•´æ€§æ¸¬è©¦
```
âœ… å¾žå­¸ç¿’æ­·å²åˆå§‹åŒ–
âœ… ç·´ç¿’è¨˜éŒ„æ­£ç¢ºå„²å­˜
âœ… æœ€é«˜åˆ†è¨ˆç®—æ­£ç¢º
âœ… ç·´ç¿’æ¬¡æ•¸ç´¯åŠ æ­£ç¢º
âœ… æ™‚é–“æˆ³è¨˜éŒ„æ­£ç¢º
```

---

## ðŸ“ ä½¿ç”¨è€…æ“ä½œæµç¨‹

### å®Œæ•´çš„ä½¿ç”¨æµç¨‹ï¼š

1. **é€²å…¥å­¸ç¿’è¨˜éŒ„**
   - é»žæ“Šå°Žèˆªåˆ—çš„ "Learning History"
   - é è¨­é¡¯ç¤º "Learning Reports" Tab

2. **åˆ‡æ›åˆ°å›žæ”¾ç·´ç¿’**
   - é»žæ“Š "ðŸ”„ Playback Practice" Tab
   - æŸ¥çœ‹æ‰€æœ‰å·²å®Œæˆçš„èª²ç¨‹

3. **é¸æ“‡èª²ç¨‹**
   - é»žæ“Šèª²ç¨‹å¡ç‰‡å±•é–‹
   - æŸ¥çœ‹æ‰€æœ‰é¡Œç›®å’Œæœ€é«˜åˆ†

4. **é–‹å§‹ç·´ç¿’**
   - é»žæ“Š "Practice â†’" æŒ‰éˆ•
   - é€²å…¥å–®é¡Œç·´ç¿’é é¢

5. **ç·´ç¿’é¡Œç›®**
   - é»žæ“Š "ðŸ”Š Listen to Question" è½ TTS
   - é»žæ“Š "ðŸŽ§ Listen to My Recording" è½ä¸Šæ¬¡éŒ„éŸ³
   - é»žæ“Š "ðŸŽ¤ Start Recording" é–‹å§‹éŒ„éŸ³
   - é»žæ“Š "â¹ï¸ Stop Recording" åœæ­¢éŒ„éŸ³

6. **æŸ¥çœ‹çµæžœ**
   - è‡ªå‹•è©•åˆ† (é¡¯ç¤º Loading)
   - å³å´å¡ç‰‡é¡¯ç¤ºæœ€æ–°åˆ†æ•¸
   - æŸ¥çœ‹äº”ç¶­åº¦åˆ†æ•¸å’Œå»ºè­°
   - å¦‚æžœè¶…éŽæœ€é«˜åˆ†ï¼Œé¡¯ç¤º ðŸŽ‰ æç¤º

7. **ç¹¼çºŒç·´ç¿’**
   - å¯ä»¥é‡è¤‡éŒ„éŸ³
   - æ¯æ¬¡éƒ½æœƒé¡¯ç¤ºæ–°çš„è©•åˆ†
   - æœ€é«˜åˆ†æœƒè‡ªå‹•æ›´æ–°

8. **è¿”å›žåˆ—è¡¨**
   - é»žæ“Š "â† Back to List" è¿”å›ž
   - æŸ¥çœ‹å…¶ä»–é¡Œç›®

---

## ðŸŽ‰ å®Œæˆç‹€æ…‹

**æ‰€æœ‰åŠŸèƒ½å·²å¯¦ä½œå®Œæˆï¼** âœ…

### å¯¦ä½œæ¸…å–®ï¼š
- âœ… è³‡æ–™çµæ§‹å’Œå„²å­˜ç³»çµ±
- âœ… Tab åˆ‡æ›ä»‹é¢
- âœ… å›žæ”¾ç·´ç¿’åˆ—è¡¨ (å¯å±•é–‹/æ”¶åˆ)
- âœ… å–®é¡Œç·´ç¿’é é¢
- âœ… TTS æ’­æ”¾åŠŸèƒ½
- âœ… éŒ„éŸ³åŠŸèƒ½
- âœ… æ’­æ”¾éŒ„éŸ³åŠŸèƒ½
- âœ… è‡ªå‹•è©•åˆ†
- âœ… æœ€é«˜åˆ†è¿½è¹¤
- âœ… ç·´ç¿’æ¬¡æ•¸çµ±è¨ˆ
- âœ… è©³ç´°å»ºè­°é¡¯ç¤º
- âœ… æ‰€æœ‰ UI å…ƒä»¶
- âœ… éŸ¿æ‡‰å¼è¨­è¨ˆ
- âœ… å‹•ç•«æ•ˆæžœ
- âœ… éŒ¯èª¤è™•ç†

---

## ðŸ”® æœªä¾†å¯æ“´å±•åŠŸèƒ½ (å¯é¸)

1. **çµ±è¨ˆåœ–è¡¨**
   - ç·´ç¿’é€²åº¦æ›²ç·š
   - åˆ†æ•¸æå‡è¶¨å‹¢
   - äº”ç¶­åº¦é›·é”åœ–

2. **ç¯©é¸å’ŒæŽ’åº**
   - æŒ‰åˆ†æ•¸ç¯©é¸
   - æŒ‰ç·´ç¿’æ¬¡æ•¸æŽ’åº
   - æŒ‰æœ€å¾Œç·´ç¿’æ™‚é–“æŽ’åº

3. **æˆå°±ç³»çµ±**
   - é¦–æ¬¡æ»¿åˆ†
   - é€£çºŒç·´ç¿’å¤©æ•¸
   - ç¸½ç·´ç¿’æ¬¡æ•¸é‡Œç¨‹ç¢‘

4. **èªžéŸ³å°æ¯”**
   - èˆ‡æ¨™æº–ç™¼éŸ³å°æ¯”
   - æ³¢å½¢è¦–è¦ºåŒ–
   - èªžèª¿åˆ†æž

5. **æ‰¹æ¬¡ç·´ç¿’**
   - é¸æ“‡å¤šå€‹é¡Œç›®
   - è‡ªå‹•åˆ‡æ›ä¸‹ä¸€é¡Œ
   - æ‰¹æ¬¡è©•åˆ†å ±å‘Š

---

## ðŸ“± ç³»çµ±éœ€æ±‚

- ç€è¦½å™¨éœ€æ”¯æ´ MediaRecorder API
- éœ€è¦éº¥å…‹é¢¨æ¬Šé™
- æ”¯æ´ Web Speech API (TTS)
- localStorage å¯ç”¨

---

## ðŸŽŠ ç¸½çµ

é€™æ¬¡å¯¦ä½œå®Œæ•´å»ºç«‹äº†ä¸€å€‹åŠŸèƒ½è±å¯Œçš„å›žæ”¾ç·´ç¿’ç³»çµ±ï¼Œè®“å­¸ç¿’è€…å¯ä»¥ï¼š
- ðŸ”„ éš¨æ™‚é‡æ–°ç·´ç¿’ä»»ä½•é¡Œç›®
- ðŸ“ˆ è¿½è¹¤è‡ªå·±çš„é€²æ­¥
- ðŸŽ¯ ç²å¾—å…·é«”çš„æ”¹é€²å»ºè­°
- â­ æŒ‘æˆ°æ›´é«˜åˆ†æ•¸
- ðŸŽ§ è½å–è‡ªå·±çš„ç™¼éŸ³

æ‰€æœ‰åŠŸèƒ½éƒ½å®Œç¾Žæ•´åˆåˆ°ç¾æœ‰ç³»çµ±ä¸­ï¼Œä¿æŒäº†ä¸€è‡´çš„ UI/UX é¢¨æ ¼ï¼
