# ğŸ”§ èªéŸ³è©•åˆ†ç³»çµ±è¨ºæ–·èˆ‡ä¿®å¾©å ±å‘Š

## ğŸ“‹ å•é¡Œæè¿°

ç”¨æˆ¶åæ˜ ï¼š**ä¸ç®¡å¿µéŒ¯å­—é‚„æ˜¯åœ¨è©•åˆ†ç’°ç¯€éƒ½é€šé**

## ğŸ” è¨ºæ–·çµæœ

### 1. ç³»çµ±æ¶æ§‹åˆ†æ

#### å¾Œç«¯è©•åˆ†é‚è¼¯ (`apps/backend/src/routes/score.ts`)
- âœ… Gemini API å·²æ­£ç¢ºé…ç½®ï¼ˆAPI Key: AIzaSy...Xk14ï¼‰
- âœ… è©•åˆ†ç«¯é»æ­£å¸¸å·¥ä½œï¼š`POST /api/score`
- âœ… æ”¯æ´å…©ç¨®æ¨¡å¼ï¼š
  - **æœ‰éŸ³é » + API Key**ï¼šä½¿ç”¨ Gemini 2.0 Flash é€²è¡ŒèªéŸ³è­˜åˆ¥å’Œè©•åˆ†
  - **ç„¡éŸ³é »**ï¼šä½¿ç”¨æ¨¡æ“¬è©•åˆ†ï¼ˆéš¨æ©Ÿ 60-100 åˆ†ï¼‰

#### å‰ç«¯èª¿ç”¨é‚è¼¯ (`apps/web/app/(protected)/lesson/[id]/page.tsx`)
- âœ… æ­£ç¢ºéŒ„éŸ³ä¸¦ç™¼é€åˆ°å¾Œç«¯
- âœ… é€šéé–€æª»ï¼šscore >= 75

### 2. å¯¦éš›æ¸¬è©¦çµæœ

æ ¹æ“šå¾Œç«¯æ—¥èªŒï¼Œæˆ‘å€‘ç™¼ç¾ï¼š

```
æ¸¬è©¦ 1: æœŸæœ›ç­”æ¡ˆ "ä½ å¥½"ï¼Œå¯¦éš›éŒ„éŸ³ "ä½ å¥½"
çµæœ: 95 åˆ† âœ… (æ­£ç¢ºé€šé)

æ¸¬è©¦ 2: æœŸæœ›ç­”æ¡ˆ "æˆ‘æ˜¯å­¸ç”Ÿ"ï¼Œå¯¦éš›éŒ„éŸ³ "æˆ‘ä¸æ˜¯å­¸ç”Ÿ"
çµæœ: 75 åˆ† âš ï¸ (éŒ¯èª¤ä½†é€šéï¼)
- transcript: 'æˆ‘ä¸æ˜¯å­¦ç”Ÿ'
- feedback: "The pronunciation of 'ä¸' (bÃ¹) and 'å­¦' (xuÃ©) could be improved..."

æ¸¬è©¦ 3: æœŸæœ›ç­”æ¡ˆ "æˆ‘æ˜¯è€å¸«"ï¼Œå¯¦éš›éŒ„éŸ³ "æˆ‘ä¸æ˜¯è€å¸«"
çµæœ: 75 åˆ† âš ï¸ (éŒ¯èª¤ä½†é€šéï¼)
- transcript: 'æˆ‘ä¸æ˜¯è€å¸«'
- feedback: "...the expected answer was either 'æˆ‘æ˜¯è€å¸«' or 'æˆ‘æ˜¯ç¾åœ‹äºº', and your answer deviated from that..."
```

### 3. æ ¹æœ¬åŸå› 

**è©•åˆ†æ¨™æº–éæ–¼å¯¬é¬†**ï¼šåŸå…ˆçš„æ¬Šé‡é…ç½®

```
- Pronunciation accuracy (30%)
- Tone accuracy (30%)
- Fluency (20%)
- Completeness (20%)
```

å•é¡Œï¼šå³ä½¿**å…§å®¹å®Œå…¨éŒ¯èª¤**ï¼Œåªè¦ç™¼éŸ³æµæš¢ã€è²èª¿æº–ç¢ºï¼Œä»ç„¶å¯ä»¥ç²å¾— 75 åˆ†ä»¥ä¸Šï¼

## âœ… ä¿®å¾©æ–¹æ¡ˆ

### ä¿®æ”¹è©•åˆ†æ¨™æº–ï¼ˆå·²å¯¦æ–½ï¼‰

æ›´æ–° `apps/backend/src/routes/score.ts` çš„è©•åˆ†æ¨™æº–ï¼š

```typescript
'Scoring criteria (STRICT):',
'- Content Accuracy (50%): The spoken content MUST match the expected answer',
'  * If content is completely wrong or significantly different: 0-40 points',
'  * If content has minor errors: 40-70 points',
'  * If content is correct: 70-100 points',
'- Pronunciation accuracy (20%): Clarity of individual sounds',
'- Tone accuracy (20%): Correct tones for each character',
'- Fluency (10%): Natural speed and rhythm',
'',
'CRITICAL RULES:',
'1. If the transcript does NOT match expected answer â†’ overall_score MUST be < 70',
'2. If transcript is completely different â†’ overall_score MUST be < 50',
'3. Only give score >= 75 if content matches AND pronunciation is good',
```

### é—œéµæ”¹é€²

1. **å…§å®¹æ­£ç¢ºæ€§æå‡è‡³ 50% æ¬Šé‡**
   - å…§å®¹å®Œå…¨éŒ¯èª¤ â†’ 0-40 åˆ†ï¼ˆç„¡æ³•é€šéï¼‰
   - å…§å®¹æœ‰å°éŒ¯èª¤ â†’ 40-70 åˆ†ï¼ˆç„¡æ³•é€šéï¼‰
   - å…§å®¹æ­£ç¢º â†’ 70-100 åˆ†ï¼ˆå¯èƒ½é€šéï¼‰

2. **æ·»åŠ åš´æ ¼è¦å‰‡**
   - è½‰éŒ„æ–‡å­—ä¸ç¬¦åˆæœŸæœ›ç­”æ¡ˆ â†’ å¿…é ˆ < 70 åˆ†
   - å…§å®¹å®Œå…¨ä¸åŒ â†’ å¿…é ˆ < 50 åˆ†
   - åªæœ‰å…§å®¹åŒ¹é…ä¸”ç™¼éŸ³å¥½ â†’ æ‰èƒ½ >= 75 åˆ†

## ğŸ§ª é©—è­‰æ–¹æ³•

### æ¸¬è©¦è…³æœ¬

å·²å‰µå»º `test-scoring.js` ç”¨æ–¼æ¸¬è©¦è©•åˆ†ç³»çµ±ï¼š

```bash
node test-scoring.js
```

### æ‰‹å‹•æ¸¬è©¦æ­¥é©Ÿ

1. **å•Ÿå‹•æœå‹™**
   ```bash
   # å¾Œç«¯
   cd apps/backend
   npm run dev

   # å‰ç«¯ï¼ˆæ–°çª—å£ï¼‰
   cd apps/web
   npm run dev
   ```

2. **è¨ªå•èª²ç¨‹é é¢**
   - æ‰“é–‹ï¼šhttp://localhost:3000/lesson/L1

3. **æ¸¬è©¦æ­£ç¢ºç­”æ¡ˆ**
   - å•é¡Œ 1ï¼š"ä½ å¥½"
   - æ­£ç¢ºç™¼éŸ³ "ä½ å¥½" â†’ æ‡‰è©² >= 90 åˆ† âœ…

4. **æ¸¬è©¦éŒ¯èª¤ç­”æ¡ˆ**
   - å•é¡Œ 1ï¼š"ä½ å¥½"
   - æ•…æ„èªª "å†è¦‹" æˆ– "æˆ‘ä¸æ˜¯å­¸ç”Ÿ" â†’ æ‡‰è©² < 70 åˆ† âŒ

## ğŸ“Š é æœŸæ•ˆæœ

ä¿®å¾©å¾Œçš„è©•åˆ†ç³»çµ±ï¼š

| å ´æ™¯ | èˆŠç³»çµ± | æ–°ç³»çµ± |
|------|--------|--------|
| æ­£ç¢ºç­”æ¡ˆ + å¥½ç™¼éŸ³ | 90-100 åˆ† âœ… | 90-100 åˆ† âœ… |
| æ­£ç¢ºç­”æ¡ˆ + ä¸€èˆ¬ç™¼éŸ³ | 75-85 åˆ† âœ… | 75-85 åˆ† âœ… |
| éŒ¯èª¤ç­”æ¡ˆ + å¥½ç™¼éŸ³ | 70-80 åˆ† âš ï¸ | 30-50 åˆ† âŒ |
| éŒ¯èª¤ç­”æ¡ˆ + å·®ç™¼éŸ³ | 60-70 åˆ† âš ï¸ | 0-40 åˆ† âŒ |
| å®Œå…¨æ²’èªªè©± | éš¨æ©Ÿåˆ†æ•¸ | 0-20 åˆ† âŒ |

## ğŸš€ æœå‹™ç‹€æ…‹

- âœ… å¾Œç«¯ï¼šhttp://localhost:8082 (å·²é‡å•Ÿ)
- âœ… å‰ç«¯ï¼šhttp://localhost:3000 (å·²é‡å•Ÿ)
- âœ… è©•åˆ† APIï¼šPOST /api/score
- âœ… Gemini APIï¼šå·²é…ç½®ä¸”æ­£å¸¸å·¥ä½œ

## ğŸ“ æ³¨æ„äº‹é …

### Gemini API ä½¿ç”¨

1. **æœ‰éŸ³é »æ–‡ä»¶**ï¼šä½¿ç”¨ Gemini 2.0 Flash é€²è¡ŒçœŸå¯¦è©•åˆ†
   - å„ªé»ï¼šæº–ç¢ºè­˜åˆ¥èªéŸ³ï¼Œèƒ½å€åˆ†å°éŒ¯
   - ç¼ºé»ï¼šéœ€è¦ API é…é¡

2. **ç„¡éŸ³é »æ–‡ä»¶**ï¼šä½¿ç”¨æ¨¡æ“¬è©•åˆ†ï¼ˆåƒ…æ¸¬è©¦ç”¨ï¼‰
   - å„ªé»ï¼šä¸æ¶ˆè€— API é…é¡
   - ç¼ºé»ï¼šéš¨æ©Ÿåˆ†æ•¸ï¼Œç„¡æ³•æº–ç¢ºè©•åˆ†

### ç€è¦½å™¨éº¥å…‹é¢¨æ¬Šé™

ç¢ºä¿ç€è¦½å™¨å·²å…è¨±éº¥å…‹é¢¨æ¬Šé™ï¼š
- Chrome: é»æ“Šç¶²å€åˆ—çš„é–é ­åœ–æ¨™ â†’ å…è¨±éº¥å…‹é¢¨
- Edge: åŒä¸Š

## ğŸ¯ ä¸‹ä¸€æ­¥æ¸¬è©¦

1. æ‰“é–‹ http://localhost:3000/lesson/L1
2. æ¸¬è©¦å•é¡Œ 1ï¼š"ä½ å¥½"
   - âœ… æ­£ç¢ºèªª "ä½ å¥½" â†’ é æœŸ 90+ åˆ†
   - âŒ æ•…æ„èªª "å†è¦‹" â†’ é æœŸ < 50 åˆ†
3. æŸ¥çœ‹å¾Œç«¯çµ‚ç«¯æ—¥èªŒç¢ºèª Gemini API è¢«èª¿ç”¨
4. ç¢ºèªéŒ¯èª¤ç­”æ¡ˆç„¡æ³•é€šéï¼ˆ< 75 åˆ†ï¼‰

---

**ä¿®å¾©å®Œæˆæ™‚é–“**: 2025-10-15  
**ä¿®å¾©ç‹€æ…‹**: âœ… è©•åˆ†æ¨™æº–å·²æ›´æ–°ä¸¦é‡å•Ÿæœå‹™  
**éœ€è¦ç”¨æˆ¶é©—è­‰**: è«‹å¯¦éš›æ¸¬è©¦èªéŸ³éŒ„éŸ³åŠŸèƒ½
