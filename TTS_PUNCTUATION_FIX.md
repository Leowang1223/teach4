# TTS 標點符號過濾功能 ✅

## 修改內容

### 問題描述
TTS（文字轉語音）會念出標點符號，例如「逗號」、「句號」等，影響聽力體驗。

### 解決方案
添加 `removePunctuation` 函數，在 TTS 播放前自動移除所有標點符號。

## 修改文件
**文件**: `apps/web/app/(protected)/lesson/[id]/page.tsx`

### 1. 新增函數：移除標點符號

```typescript
// 🔧 移除標點符號，避免 TTS 念出標點
const removePunctuation = (text: string): string => {
  // 移除常見的中英文標點符號，但保留空格和字母數字
  return text
    .replace(/[，,。.！!？?；;：:、""''「」『』【】《》〈〉（）()]/g, ' ')
    .replace(/\s+/g, ' ') // 將多個空格替換為單個空格
    .trim()
}
```

**過濾的標點符號包括：**
- 中文標點：，。！？；：、""''「」『』【】《》〈〉
- 英文標點：,.!?;:""''()
- 括號：（）()

### 2. 在 playTTS 函數中應用

**修改前：**
```typescript
// 過濾掉拼音
const cleanText = removePinyin(text)
```

**修改後：**
```typescript
// 過濾掉拼音和標點符號
let cleanText = removePinyin(text)
cleanText = removePunctuation(cleanText)
```

## 處理流程

```
原始文本
  ↓
removePinyin() → 移除拼音（括號內容）
  ↓
removePunctuation() → 移除標點符號
  ↓
語音合成播放
```

## 示例

### 輸入文本：
```
你好，請問你的名字是什麼？(nǐ hǎo, qǐng wèn nǐ de míng zi shì shén me?)
```

### 處理步驟：

1. **removePinyin()** → 移除括號內的拼音
   ```
   你好，請問你的名字是什麼？
   ```

2. **removePunctuation()** → 移除標點符號
   ```
   你好 請問你的名字是什麼
   ```

3. **TTS 播放** → 只念文字，不念標點

## 測試步驟

1. **訪問課程頁面**
   ```
   http://localhost:3000/lesson/L1
   ```

2. **聽取 TTS 播放**
   - 點擊課程開始
   - 聽取系統朗讀的中文和英文
   - 確認不會念出「逗號」、「句號」等標點符號

3. **測試不同的句子**
   - 包含多個標點符號的長句
   - 中英文混合的句子
   - 包含括號、引號的句子

## 預期效果

### ✅ 修改前（會念標點）
> "你好**逗號**請問你的名字是什麼**問號**"

### ✅ 修改後（不念標點）
> "你好 請問你的名字是什麼"

## 技術細節

### 正則表達式說明
```typescript
/[，,。.！!？?；;：:、""''「」『』【】《》〈〉（）()]/g
```

- `[...]` - 字符類，匹配任何一個括號內的字符
- `g` - 全局標誌，替換所有匹配項

### 為什麼替換為空格？
- 避免詞語連接在一起
- 保持語音的自然停頓
- 例如：「你好，世界」→「你好 世界」（有停頓）

### 為什麼要 `.replace(/\s+/g, ' ')`？
- 將多個連續空格合併為一個
- 避免過長的停頓
- 例如：「你好   世界」→「你好 世界」

## 向後兼容性
✅ 完全向後兼容，不影響現有功能
✅ 只影響 TTS 播放，不影響顯示文本
✅ 不影響評分和記錄功能

## 測試檢查清單

- [ ] 中文文本不念標點符號
- [ ] 英文文本不念標點符號
- [ ] 中英文混合文本正常播放
- [ ] 拼音過濾功能仍然正常（括號內容被移除）
- [ ] 語音播放順序正確（先中文後英文或反之）
- [ ] 台灣口音正常使用
- [ ] 顯示的文本仍然包含標點符號（只過濾 TTS）

## 完成時間
2025-10-09

## 狀態
✅ 已完成，等待測試

---

## 🎬 現在可以測試了！
1. 刷新頁面（Ctrl+F5）
2. 進入任意課程
3. 聽取 TTS 播放
4. 確認不會念出標點符號
