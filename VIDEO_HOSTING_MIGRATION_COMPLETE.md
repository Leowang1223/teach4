# ğŸ¬ å½±ç‰‡è¨—ç®¡ç³»çµ±é·ç§»å®Œæˆå ±å‘Š

## ğŸ“‹ ä¿®æ”¹ç¸½çµ

### âœ… å·²å®Œæˆçš„ä¿®æ”¹

#### 1ï¸âƒ£ å¾Œç«¯èª²ç¨‹è³‡æ–™ (L1.json)
**æª”æ¡ˆ**: `apps/backend/src/plugins/chinese-lessons/L1.json`

**ä¿®æ”¹å…§å®¹**:
- âŒ ç§»é™¤: YouTube URLs (4 å€‹æ­¥é©Ÿ)
  - `https://youtube.com/shorts/LaKpMsKzAlI`
  - `https://youtube.com/shorts/7l51ah8ktKc`
  - `https://youtube.com/shorts/mpZIUhuH3Tc`
  - `https://youtube.com/shorts/5Fj8E7EhJxQ`

- âœ… æ–°å¢: æœ¬åœ° MP4 è·¯å¾‘
  - `/videos/lessons/L1/step1.mp4` (ä½ å¥½)
  - `/videos/lessons/L1/step2.mp4` (æˆ‘æ˜¯å­¸ç”Ÿ)
  - `/videos/lessons/L1/step3.mp4` (é€ å¥ç·´ç¿’)
  - `/videos/lessons/L1/step4.mp4` (ç¶œåˆè¤‡ç¿’)

#### 2ï¸âƒ£ å‰ç«¯å½±ç‰‡é¡¯ç¤ºé‚è¼¯ (page.tsx)
**æª”æ¡ˆ**: `apps/web/app/(protected)/lesson/[id]/page.tsx`

**ç§»é™¤çš„åŠŸèƒ½**:
- âŒ `isYouTubeUrl()` - YouTube URL æª¢æ¸¬å‡½æ•¸
- âŒ `getYouTubeEmbedUrl()` - YouTube åµŒå…¥ URL è½‰æ›å‡½æ•¸
- âŒ `<iframe>` - YouTube æ’­æ”¾å™¨
- âŒ è‡ªè¨‚è¦–é »æ§åˆ¶å™¨ (æ’­æ”¾/æš«åœæŒ‰éˆ•ã€é€²åº¦æ¢ã€æ™‚é–“é¡¯ç¤º)

**æ–°å¢çš„åŠŸèƒ½**:
- âœ… ç°¡åŒ–çš„ `<video>` æ¨™ç±¤é¡¯ç¤º
- âœ… åŸç”Ÿç€è¦½å™¨æ§åˆ¶å™¨ (controls)
- âœ… é™åˆ¶åŠŸèƒ½æ§åˆ¶ (controlsList)
- âœ… å„ªåŒ–çš„è¦–è¦ºæ¨£å¼

#### 3ï¸âƒ£ å½±ç‰‡é¡¯ç¤ºæ¨£å¼
```tsx
<video
  src="/videos/lessons/L1/step1.mp4"
  controls
  controlsList="nodownload nofullscreen noremoteplayback"
  playsInline
  autoPlay
  muted
  loop
  className="w-full rounded-2xl shadow-lg"
  style={{
    height: '66vh',      // ä½”ç•«é¢ 2/3
    objectFit: 'cover'   // é¿å…é»‘é‚Š
  }}
/>
```

**æ¨£å¼ç‰¹é»**:
- ğŸ“ é«˜åº¦: `66vh` (è¦–çª—é«˜åº¦çš„ 66%)
- ğŸ“ å¯¬åº¦: `100%` (å¡«æ»¿å®¹å™¨)
- ğŸ”² åœ“è§’: `rounded-2xl` (16px)
- ğŸ–¼ï¸ é©æ‡‰: `object-fit: cover` (ç„¡é»‘é‚Š)
- ğŸ¨ é™°å½±: `shadow-lg` (å¤§é™°å½±)

**æ§åˆ¶é™åˆ¶**:
- ğŸš« ç¦æ­¢ä¸‹è¼‰ (`nodownload`)
- ğŸš« ç¦æ­¢å…¨è¢å¹• (`nofullscreen`)
- ğŸš« ç¦æ­¢é ç«¯æ’­æ”¾ (`noremoteplayback`)
- âœ… å…è¨±åŸºæœ¬æ’­æ”¾æ§åˆ¶

#### 4ï¸âƒ£ æª”æ¡ˆçµæ§‹
å»ºç«‹æ–°çš„å½±ç‰‡ç›®éŒ„ï¼š
```
apps/web/public/
â””â”€â”€ videos/
    â””â”€â”€ lessons/
        â”œâ”€â”€ README.md (ä½¿ç”¨èªªæ˜)
        â””â”€â”€ L1/
            â”œâ”€â”€ PLACE_VIDEOS_HERE.md (æ”¾ç½®èªªæ˜)
            â”œâ”€â”€ step1.mp4 (å¾…æ”¾ç½®)
            â”œâ”€â”€ step2.mp4 (å¾…æ”¾ç½®)
            â”œâ”€â”€ step3.mp4 (å¾…æ”¾ç½®)
            â””â”€â”€ step4.mp4 (å¾…æ”¾ç½®)
```

---

## ğŸ¯ ä¿ç•™çš„åŠŸèƒ½

### âœ… å®Œå…¨ä¸å—å½±éŸ¿çš„åŠŸèƒ½
1. **å­—å¹•ç³»çµ±** - `currentCaption` é¡¯ç¤º
2. **TTS èªéŸ³** - æ²’æœ‰å½±ç‰‡æ™‚çš„å‚™ç”¨æ–¹æ¡ˆ
3. **éŒ„éŸ³åŠŸèƒ½** - èªéŸ³éŒ„è£½å’Œè©•åˆ†
4. **è©•åˆ†ç³»çµ±** - Gemini API è©•åˆ†
5. **å ±è¡¨ç³»çµ±** - èª²ç¨‹å®Œæˆå ±è¡¨
6. **å­¸ç¿’æ­·å²** - æ­·å²è¨˜éŒ„å­˜å„²
7. **Retry åŠŸèƒ½** - é‡æ–°ç·´ç¿’æŒ‰éˆ•
8. **æ‰€æœ‰ UI å…ƒç´ ** - æŒ‰éˆ•ã€ä½ˆå±€ã€æ¨£å¼

### âš™ï¸ è‡ªå‹•æ’­æ”¾é‚è¼¯
```typescript
// æ­¥é©Ÿåˆ‡æ›æ™‚è‡ªå‹•æ’­æ”¾å½±ç‰‡
if (currentStep.video_url && videoRef.current) {
  videoRef.current.src = currentStep.video_url
  videoRef.current.play().catch(err => {
    console.error('Video autoplay failed:', err)
    setNeedsManualPlay(true)  // é¡¯ç¤ºæ‰‹å‹•æ’­æ”¾æŒ‰éˆ•
  })
}
```

---

## ğŸ“¦ ä¸‹ä¸€æ­¥æ“ä½œ

### 1ï¸âƒ£ æº–å‚™å½±ç‰‡æª”æ¡ˆ
ä½ éœ€è¦æº–å‚™ 4 å€‹ MP4 å½±ç‰‡æª”æ¡ˆï¼š

| æª”æ¡ˆå | èª²ç¨‹å…§å®¹ | å»ºè­°é•·åº¦ |
|--------|----------|----------|
| `step1.mp4` | æ•™å­¸ "ä½ å¥½" (Hello) | 10-30 ç§’ |
| `step2.mp4` | æ•™å­¸ "æˆ‘æ˜¯å­¸ç”Ÿ" (I am a student) | 15-40 ç§’ |
| `step3.mp4` | é€ å¥ç·´ç¿’ç¤ºç¯„ | 20-50 ç§’ |
| `step4.mp4` | ç¶œåˆè¤‡ç¿’ç¤ºç¯„ | 20-50 ç§’ |

### 2ï¸âƒ£ æ”¾ç½®å½±ç‰‡
å°‡ MP4 æª”æ¡ˆè¤‡è£½åˆ°ï¼š
```
apps/web/public/videos/lessons/L1/
```

### 3ï¸âƒ£ æ¸¬è©¦å½±ç‰‡
1. ç¢ºä¿é–‹ç™¼ä¼ºæœå™¨æ­£åœ¨é‹è¡Œï¼š`npm run dev`
2. è¨ªå•ï¼š`http://localhost:3000/lesson/L1`
3. æª¢æŸ¥æ¯å€‹æ­¥é©Ÿçš„å½±ç‰‡æ˜¯å¦æ­£å¸¸æ’­æ”¾

### 4ï¸âƒ£ é©—è­‰åŠŸèƒ½
- [ ] å½±ç‰‡è‡ªå‹•æ’­æ”¾
- [ ] åœ“è§’å’Œé™°å½±æ¨£å¼æ­£ç¢º
- [ ] é«˜åº¦ç‚ºè¦–çª—çš„ 2/3
- [ ] ç„¡é»‘é‚Š (object-fit: cover)
- [ ] æ§åˆ¶å™¨æ­£å¸¸å·¥ä½œ
- [ ] ç„¡æ³•ä¸‹è¼‰ã€å…¨è¢å¹•ã€é ç«¯æ’­æ”¾
- [ ] å­—å¹•é¡¯ç¤ºæ­£å¸¸
- [ ] å½±ç‰‡çµæŸå¾Œå¾ªç’°æ’­æ”¾

---

## ğŸ”§ å½±ç‰‡è¦æ ¼å»ºè­°

### æœ€ä½³è¦æ ¼
```
æ ¼å¼: MP4
ç·¨ç¢¼: H.264 (AVC)
éŸ³è¨Š: AAC
è§£æåº¦: 1920x1080 (1080p) æˆ– 1280x720 (720p)
å¹€ç‡: 30 fps æˆ– 60 fps
ä½å…ƒç‡: 5-10 Mbps (1080p) / 2.5-5 Mbps (720p)
é•·å¯¬æ¯”: 16:9 (æ©«å‘) æˆ– 9:16 (ç›´å‘ï¼Œå¦‚ Shorts)
```

### å£“ç¸®å»ºè­°
å¦‚æœåŸå§‹æª”æ¡ˆå¤ªå¤§ï¼Œå¯ä½¿ç”¨ FFmpeg å£“ç¸®ï¼š
```bash
ffmpeg -i input.mp4 -vcodec h264 -acodec aac -b:v 5M -b:a 128k output.mp4
```

---

## ğŸš€ å„ªå‹¢åˆ†æ

### YouTube vs æœ¬åœ°è¨—ç®¡

| ç‰¹æ€§ | YouTube | æœ¬åœ° MP4 |
|------|---------|----------|
| è¼‰å…¥é€Ÿåº¦ | âš ï¸ ä¾è³´å¤–éƒ¨ | âœ… å¿«é€Ÿ |
| ç¶²è·¯éœ€æ±‚ | âŒ å¿…é ˆé€£ç¶² | âœ… é›¢ç·šå¯ç”¨ |
| å»£å‘Šå¹²æ“¾ | âŒ å¯èƒ½å‡ºç¾ | âœ… ç„¡å»£å‘Š |
| æ§åˆ¶æ¬Š | âš ï¸ æœ‰é™ | âœ… å®Œå…¨æ§åˆ¶ |
| æ¨£å¼è‡ªè¨‚ | âŒ å—é™ | âœ… å®Œå…¨è‡ªè¨‚ |
| éš±ç§ä¿è­· | âš ï¸ Google è¿½è¹¤ | âœ… å®Œå…¨éš±ç§ |
| æª”æ¡ˆç®¡ç† | âœ… YouTube ç®¡ç† | âš ï¸ è‡ªè¡Œç®¡ç† |
| é »å¯¬æˆæœ¬ | âœ… å…è²» | âš ï¸ è‡ªè¡Œè² æ“” |

---

## ğŸ“ æŠ€è¡“ç´°ç¯€

### å‰ç«¯ä¿®æ”¹æ‘˜è¦
```diff
- // YouTube URL æª¢æ¸¬å’Œè½‰æ›
- const isYouTubeUrl = (url: string): boolean => { ... }
- const getYouTubeEmbedUrl = (url: string): string => { ... }

+ // ç°¡åŒ–çš„å½±ç‰‡æ’­æ”¾é‚è¼¯
+ if (currentStep.video_url && videoRef.current) {
+   videoRef.current.src = currentStep.video_url
+   videoRef.current.play()
+ }
```

### HTML çµæ§‹è®ŠåŒ–
```diff
- <iframe src="https://www.youtube.com/embed/..." />
+ <video 
+   src="/videos/lessons/L1/step1.mp4"
+   controls
+   controlsList="nodownload nofullscreen noremoteplayback"
+   style={{ height: '66vh', objectFit: 'cover' }}
+ />
```

---

## âœ… å®Œæˆæª¢æŸ¥æ¸…å–®

- [x] ç§»é™¤ YouTube URL æª¢æ¸¬é‚è¼¯
- [x] ç§»é™¤ YouTube åµŒå…¥è½‰æ›å‡½æ•¸
- [x] ç§»é™¤ iframe æ’­æ”¾å™¨
- [x] ç§»é™¤è‡ªè¨‚è¦–é »æ§åˆ¶å™¨
- [x] æ–°å¢ç°¡åŒ–çš„ video æ¨™ç±¤
- [x] å¥—ç”¨ 66vh é«˜åº¦æ¨£å¼
- [x] å¥—ç”¨ object-fit: cover
- [x] å¥—ç”¨ controlsList é™åˆ¶
- [x] æ›´æ–° L1.json å½±ç‰‡è·¯å¾‘
- [x] å»ºç«‹å½±ç‰‡ç›®éŒ„çµæ§‹
- [x] å»ºç«‹ä½¿ç”¨èªªæ˜æ–‡ä»¶
- [ ] **å¾…è¾¦**: æ”¾ç½®å¯¦éš›å½±ç‰‡æª”æ¡ˆ
- [ ] **å¾…è¾¦**: æ¸¬è©¦å½±ç‰‡æ’­æ”¾åŠŸèƒ½

---

## ğŸ“ ä¸‹ä¸€æ­¥æ“´å±•

### æ–°å¢å…¶ä»–èª²ç¨‹
å¦‚éœ€æ–°å¢ L2, L3 ç­‰èª²ç¨‹ï¼š

1. å»ºç«‹ç›®éŒ„ï¼š
```bash
mkdir apps/web/public/videos/lessons/L2
mkdir apps/web/public/videos/lessons/L3
```

2. æ”¾ç½®å½±ç‰‡æª”æ¡ˆ
3. æ›´æ–°å°æ‡‰çš„ JSON æª”æ¡ˆï¼š
   - `apps/backend/src/plugins/chinese-lessons/L2.json`
   - `apps/backend/src/plugins/chinese-lessons/L3.json`

### æ‰¹æ¬¡è™•ç†
å¦‚æœ‰å¤§é‡å½±ç‰‡éœ€è¦è™•ç†ï¼Œå¯ä½¿ç”¨è…³æœ¬æ‰¹æ¬¡è½‰æ›ï¼š
```bash
# æ‰¹æ¬¡è½‰æ›æ‰€æœ‰å½±ç‰‡ç‚ºæœ€ä½³æ ¼å¼
for file in *.mp4; do
  ffmpeg -i "$file" -vcodec h264 -acodec aac -b:v 5M "converted_$file"
done
```

---

## ğŸ“ æ”¯æ´è³‡è¨Š

å¦‚é‡åˆ°å•é¡Œï¼Œæª¢æŸ¥ï¼š
1. å½±ç‰‡æª”æ¡ˆæ˜¯å¦åœ¨æ­£ç¢ºè·¯å¾‘
2. å½±ç‰‡æ ¼å¼æ˜¯å¦ç‚º MP4
3. ç€è¦½å™¨æ§åˆ¶å°æ˜¯å¦æœ‰éŒ¯èª¤è¨Šæ¯
4. é–‹ç™¼ä¼ºæœå™¨æ˜¯å¦æ­£å¸¸é‹è¡Œ

**å®Œæˆæ—¥æœŸ**: 2025-10-16
**ä¿®æ”¹è€…**: GitHub Copilot
**å½±éŸ¿ç¯„åœ**: èª²ç¨‹å½±ç‰‡é¡¯ç¤ºç³»çµ±
**å‘å¾Œå…¼å®¹**: âœ… å®Œå…¨å…¼å®¹å…¶ä»–åŠŸèƒ½
