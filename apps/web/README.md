# AI Mock Interview - å‰ç«¯éŸ³è¨Šè™•ç†ç³»çµ±æ¶æ§‹

## ğŸ—ï¸ ç³»çµ±æ¶æ§‹æ¦‚è¦½

å‰ç«¯éŸ³è¨Šè™•ç†ç³»çµ±ç”±å››å€‹æ ¸å¿ƒçµ„ä»¶çµ„æˆï¼Œå½¢æˆä¸€å€‹å®Œæ•´çš„éŸ³è¨Šè™•ç†ç®¡é“ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    ws.ts        â”‚    â”‚useInterviewSessionâ”‚    â”‚useSpeechStream  â”‚    â”‚   ttsPlayer.ts  â”‚
â”‚                 â”‚    â”‚       .ts        â”‚    â”‚      .ts        â”‚    â”‚                 â”‚
â”‚  WebSocket      â”‚â—„â”€â”€â–ºâ”‚   é¢è©¦æœƒè©±ç®¡ç†    â”‚â—„â”€â”€â–ºâ”‚   èªéŸ³è¼¸å…¥è™•ç†   â”‚    â”‚   éŸ³è¨Šæ’­æ”¾å™¨    â”‚
â”‚   é€šä¿¡å±¤        â”‚    â”‚                  â”‚    â”‚                 â”‚    â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ æ•¸æ“šæµå‘åœ–

```
å¾Œç«¯ Gemini Live API
         â”‚
         â–¼
    WebSocket æ¶ˆæ¯
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   ws.ts     â”‚ â† æ¥æ”¶æ‰€æœ‰ WebSocket æ¶ˆæ¯
    â”‚             â”‚ â† è‡ªå‹•é‡é€£ç®¡ç†
    â”‚             â”‚ â† æ¶ˆæ¯åˆ†ç™¼
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚useInterviewSessionâ”‚ â† è™•ç†é¢è©¦ç›¸é—œæ¶ˆæ¯
â”‚      .ts        â”‚ â† ç®¡ç†æœƒè©±ç‹€æ…‹
â”‚                 â”‚ â† èª¿ç”¨éŸ³è¨Šæ’­æ”¾
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚useSpeechStream  â”‚    â”‚   ttsPlayer.ts  â”‚
â”‚      .ts        â”‚    â”‚                 â”‚
â”‚                 â”‚    â”‚                 â”‚
â”‚ èªéŸ³éŒ„è£½        â”‚    â”‚ éŸ³è¨Šè§£ç¢¼        â”‚
â”‚ PCM è½‰æ›        â”‚    â”‚ é‚Šç•Œå¹³æ»‘        â”‚
â”‚ ä¸²æµå‚³é€        â”‚    â”‚ æ’­æ”¾æ’ç¨‹        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚
         â–¼                       â–¼
   å¾Œç«¯èªéŸ³è­˜åˆ¥              ç”¨æˆ¶è½åˆ° AI èªéŸ³
```

## ğŸ“ çµ„ä»¶è©³ç´°èªªæ˜

### 1. `ws.ts` - WebSocket é€šä¿¡å±¤
**è·è²¬**: åº•å±¤ç¶²çµ¡é€šä¿¡
- å»ºç«‹èˆ‡å¾Œç«¯çš„ WebSocket é€£æ¥
- è‡ªå‹•é‡é€£æ©Ÿåˆ¶
- æ¶ˆæ¯æ¥æ”¶å’Œåˆ†ç™¼
- äºŒé€²åˆ¶æ•¸æ“šè™•ç†ï¼ˆéŸ³è¨Šåˆ†ç‰‡ï¼‰

**é—œéµæ–¹æ³•**:
- `open()`: å»ºç«‹é€£æ¥
- `onMessage()`: è¨‚é–±æ¶ˆæ¯
- `sendBinary()`: ç™¼é€äºŒé€²åˆ¶éŸ³è¨Šæ•¸æ“š

**ä½ç½®**: `src/lib/ws/ws.ts`

### 2. `useInterviewSession.ts` - é¢è©¦æœƒè©±ç®¡ç†
**è·è²¬**: é¢è©¦æµç¨‹æ§åˆ¶
- ç®¡ç†é¢è©¦æœƒè©±ç‹€æ…‹
- è™•ç† AI å›æ‡‰æ¶ˆæ¯
- èª¿ç”¨éŸ³è¨Šæ’­æ”¾
- æä¾›é¢è©¦æ§åˆ¶ API

**é—œéµæ–¹æ³•**:
- `playAudio()`: éŸ³è¨Šæ’­æ”¾å…¥å£
- æ¶ˆæ¯è™•ç†é‚è¼¯ï¼ˆ`llm.reply`, `stt.final` ç­‰ï¼‰

**ä½ç½®**: `src/lib/useInterviewSession.ts`

### 3. `useSpeechStream.ts` - èªéŸ³è¼¸å…¥è™•ç†
**è·è²¬**: ç”¨æˆ¶èªéŸ³éŒ„è£½
- ä½¿ç”¨ AudioWorklet éŒ„è£½èªéŸ³
- PCM æ ¼å¼è½‰æ›ï¼ˆ16kHz, 16-bitï¼‰
- å¯¦æ™‚ä¸²æµå‚³é€åˆ°å¾Œç«¯
- éŒ„éŸ³ç‹€æ…‹ç®¡ç†

**é—œéµç‰¹æ€§**:
- AudioWorklet è™•ç†å™¨ (`pcm-worklet.js`)
- å¯é…ç½®çš„å–æ¨£ç‡å’Œåˆ†ç‰‡å¤§å°
- æ”¯æŒæœ¬åœ°å›æ”¾å’Œç›£è½

**ä½ç½®**: `src/lib/useSpeechStream.ts`

### 4. `ttsPlayer.ts` - éŸ³è¨Šæ’­æ”¾å™¨
**è·è²¬**: AI èªéŸ³æ’­æ”¾
- éŸ³è¨Šè§£ç¢¼ï¼ˆBase64, PCM fallbackï¼‰
- é‚Šç•Œå¹³æ»‘è™•ç†
- æ’­æ”¾æ’ç¨‹ç®¡ç†
- éŸ³è¨Šåˆä½µå’Œé‡æ¡æ¨£

**é—œéµæŠ€è¡“**:
- Web Audio API
- æ·¡å…¥æ·¡å‡ºé‚Šç•Œå¹³æ»‘
- OLA (Overlap-Add) éŸ³è¨Šåˆä½µ
- è‡ªå‹•é‡æ¡æ¨£åˆ°ç›®æ¨™å–æ¨£ç‡

**ä½ç½®**: `src/lib/ttsPlayer.ts`

## ğŸµ éŸ³è¨Šè™•ç†æµç¨‹

### è¼¸å…¥æµç¨‹ï¼ˆç”¨æˆ¶èªªè©±ï¼‰
```
éº¥å…‹é¢¨ â†’ AudioWorklet â†’ PCM 16kHz â†’ WebSocket â†’ å¾Œç«¯ STT
```

### è¼¸å‡ºæµç¨‹ï¼ˆAI å›æ‡‰ï¼‰
```
å¾Œç«¯ TTS â†’ WebSocket â†’ useInterviewSession â†’ ttsPlayer â†’ æšè²å™¨
```

## ğŸ”§ æŠ€è¡“ç‰¹é»

### 1. å¯¦æ™‚æ€§
- WebSocket é›™å‘é€šä¿¡
- AudioWorklet ä½å»¶é²è™•ç†
- æµå¼éŸ³è¨Šå‚³è¼¸

### 2. éŸ³è³ªå„ªåŒ–
- é‚Šç•Œå¹³æ»‘æ¶ˆé™¤é¡†ç²’æ„Ÿ
- è‡ªå‹•é‡æ¡æ¨£é¿å…å¤±çœŸ
- OLA éŸ³è¨Šåˆä½µæ¸›å°‘æ–·é»

### 3. ç©©å®šæ€§
- è‡ªå‹•é‡é€£æ©Ÿåˆ¶
- éŒ¯èª¤è™•ç†å’Œé™ç´š
- ç‹€æ…‹ç®¡ç†ä¸€è‡´æ€§

### 4. æ¨¡çµ„åŒ–
- æ¸…æ™°çš„è·è²¬åˆ†é›¢
- å¯é…ç½®çš„é¸é …
- æ˜“æ–¼æ“´å±•å’Œç¶­è­·

## ğŸš€ ä½¿ç”¨æ–¹å¼

### åŸºæœ¬é¢è©¦æœƒè©±
```typescript
import { useInterviewSession } from '@/lib/useInterviewSession';

function InterviewPage() {
  const { status, startInterview, stopInterview } = useInterviewSession({
    autoConnect: true,
    autoStart: false
  });

  return (
    <div>
      <button onClick={startInterview}>é–‹å§‹é¢è©¦</button>
      <button onClick={stopInterview}>çµæŸé¢è©¦</button>
      <p>ç‹€æ…‹: {status}</p>
    </div>
  );
}
```

### èªéŸ³éŒ„è£½
```typescript
import { useSpeechStream } from '@/lib/useSpeechStream';

function VoiceRecorder() {
  const { status, start, stop } = useSpeechStream({
    forwardToWs: true,
    targetSampleRate: 16000
  });

  return (
    <div>
      <button onClick={start} disabled={status === 'recording'}>
        é–‹å§‹éŒ„éŸ³
      </button>
      <button onClick={stop} disabled={status !== 'recording'}>
        åœæ­¢éŒ„éŸ³
      </button>
    </div>
  );
}
```

## ğŸ” èª¿è©¦å’Œç›£æ§

### æ—¥èªŒæª¢æŸ¥é»
- `[WS]`: WebSocket é€£æ¥ç‹€æ…‹
- `[Hook]`: React Hook åŸ·è¡Œç‹€æ…‹
- `[TTS]`: éŸ³è¨Šæ’­æ”¾ç‹€æ…‹
- `ğŸ¤`: èªéŸ³éŒ„è£½ç‹€æ…‹
- `ğŸ§`: éŸ³è¨Šæ¥æ”¶ç‹€æ…‹

### å¸¸è¦‹å•é¡Œæ’æŸ¥
1. **éŸ³è¨Šç„¡è²**: æª¢æŸ¥ AudioContext ç‹€æ…‹
2. **é€£æ¥å¤±æ•—**: æª¢æŸ¥ WebSocket URL å’Œå¾Œç«¯ç‹€æ…‹
3. **éŸ³è³ªå•é¡Œ**: æª¢æŸ¥å–æ¨£ç‡å’Œé‚Šç•Œå¹³æ»‘è¨­å®š
4. **å»¶é²éé«˜**: æª¢æŸ¥ chunk å¤§å°å’Œ lookahead è¨­å®š

## ğŸ“š ç›¸é—œæ–‡æª”
- [Web Audio API](https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API)
- [AudioWorklet](https://developer.mozilla.org/en-US/docs/Web/API/AudioWorklet)
- [WebSocket](https://developer.mozilla.org/en-US/docs/Web/API/WebSocket)
- [React Hooks](https://react.dev/reference/react/hooks)
